{
    "collab_server" : "",
    "contents" : "####################Load packages\n#install.packages(\"lme4\");install.packages(\"lsmeans\");install.packages(\"lmerTest\");\n#install.packages(\"MASS\");install.packages(\"Rmisc\");\n#install.packages(\"dplyr\");install.packages(\"Rmisc\");\nlibrary(lme4);library(lsmeans);library(lmerTest);library(MASS)\nlibrary(ggplot2); library(Rmisc);\nlibrary(dplyr)\n\n####################Read in data\nd=read.csv(\"data.csv\",header=TRUE)\nd;attach(d)\nhead(d)\n\n####################Prepare data\n#Transform data - Because the residuals was not normally distributed in the model\n#INFO: page 231, 0.5 was added to all (Sokal and Rohlf) and a natural log transformation was done - because lambda = 0 in boxcox\nnr_of_clutches<-log(d$nr_of_clutches+0.5)\n\n###################Finding the right model\n#Quick look at the data\nd$combine_trial_dist<-as.factor(paste(trial_type,target_distance,sep=\"\"))\t\nplot(d$combine_trial_dist,nr_of_clutches)\t\t#Corresponds to model 3 (without user_id)\nplot(trial_type,nr_of_clutches)\t\t\t#Corresponds to a model with only trial type\n\n#Model reduction\nmodel4<-lmer(nr_of_clutches ~ trial_type*target_distance + direction_axis*trial_type + task_number + (1|user_id))\t\t#Repeated measures factorial ANCOVA (mixed effects model) with interaction (user is random effect)\n\n#Test of interaction\nmodel3<-lmer(nr_of_clutches ~ trial_type*target_distance + direction_axis + task_number + (1|user_id))\t\t#Repeated measures factorial ANCOVA (mixed effects model) with interaction (user is random effect)\nanova(model3,model4)\n\nmodel2<-lmer(nr_of_clutches ~ trial_type + target_distance + direction_axis + task_number + (1|user_id))\n\tanova(model2,model3)\n\n\t#Because the models are significantly different (p<0.05) (the interaction is significant so we cannot exclude it),\n\t#so we carry on with model 3.\n\n#Test of task_number\nmodel1<-lmer(nr_of_clutches ~ trial_type*target_distance + direction_axis + (1|user_id))\t\t#ANOVA\n\tanova(model3,model1)\n\n\t#Because the models are NOT significantly different (p<0.05) (the task_number is NOT significant),\n\t#so we carry on with model 1.\n\n#Test of direction_axis\nmodel0<-lmer(nr_of_clutches ~ trial_type*target_distance + (1|user_id))\t\t#ANOVA\n\tanova(model1,model0)\n\n\t#Because the models are significantly different (p<0.05) (the direction_axis IS significant),\n\t#so model 1 is our final model.\n\n\n####################Hypothesis testing - Test if there is a difference between trial types\n#p value for interaction\nmodel1.pval<-lmer(nr_of_clutches ~ trial_type+target_distance + direction_axis + (1|user_id))\t\t#ANOVA\n\tanova(model1,model1.pval)\n\t\n#From above we saw that the interaction was significant. With LSM we can test the difference for each level\nLSM<-lsmeans::lsmeans(model1,~trial_type*target_distance)\t#Estimates for each level\n\tT<-contrast(LSM, \"pairwise\",adjust=\"none\");T\t\t#Estiates for the contrasts\n\tCIs<-confint(T)\t\t\t\t\t\t\t#95% CIs for the contrasts\n\tLSM_summary<-summary(LSM)\n\t#Back transformation\n\tLSM_summary$lsmean <- exp(LSM_summary$lsmean)-0.5\n\tLSM_summary$lower.CL <- exp(LSM_summary$lower.CL)-0.5\n\tLSM_summary$upper.CL <- exp(LSM_summary$upper.CL)-0.5\n\tLSM_summary$target_distance <- factor(LSM_summary$target_distance, levels = rev(levels(LSM_summary$target_distance)))\n\tggplot(LSM_summary, aes(x=target_distance, y=lsmean, colour=trial_type, group=trial_type)) + \n\t  geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=.1, \n\t                position=position_dodge(0.00)) +\n\t  scale_colour_hue(name=\"Interaction Method\")  +     # Set legend title\n\t  scale_linetype_discrete(name=\"Interaction Method\") +\n\t  xlab(\"Target Distance\") +\n\t  ylab(\"Number of clutches\") +\n\t  geom_line() +\n\t  geom_point()\n#Read about lsmeans: https://cran.r-project.org/web/packages/lsmeans/vignettes/using-lsmeans.pdf\n\t\n#####################Plotting directions for the model\nLSM_with_direction<-lsmeans::lsmeans(model1,~trial_type*target_distance*direction_axis)\t#Estimates for each level\nT_with_direction<-contrast(LSM_with_direction, \"pairwise\",adjust=\"none\");\t\t#Estiates for the contrasts\nLSM_summary<-summary(LSM_with_direction)\n\n#capture.output(T_with_direction,file=paste(\"Direction Contrast\",\".doc\",sep=\"\"))\n\n#Back transformation\nLSM_summary$lsmean <- exp(LSM_summary$lsmean)-0.5\nLSM_summary$lower.CL <- exp(LSM_summary$lower.CL)-0.5\nLSM_summary$upper.CL <- exp(LSM_summary$upper.CL)-0.5\nLSM_summary$target_distance <- factor(LSM_summary$target_distance, levels = rev(levels(LSM_summary$target_distance)))\n\n#Subset\nmidair.subset<-subset(LSM_summary,trial_type==\"midair\")\ntouch.subset<-subset(LSM_summary,trial_type==\"touch+inertia\")\n\n#plot touch\nggplot(touch.subset, aes(x=target_distance, y=lsmean, colour=direction_axis, group=interaction(trial_type,direction_axis))) + \n  geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=.1, \n                position=position_dodge(0.2)) +\n  scale_colour_hue(name=\"Target Direction\")  +     # Set legend title\n  scale_linetype_discrete(name=\"Target Direction\") +\n  xlab(\"Target Distance\") +\n  ylab(\"Number of clutches\") +\n  geom_line(position=position_dodge(0.2)) +\n  geom_point(position=position_dodge(0.2))\n\n  #ggtitle(\"Number of clutches against distance stratified by direction for the touch+inertia interaction method\")\n\n#plot midair\nggplot(midair.subset, aes(x=target_distance, y=lsmean, colour=direction_axis, group=interaction(trial_type,direction_axis))) + \n  geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=.1, \n                position=position_dodge(0.2)) +\n  scale_colour_hue(name=\"Target Direction\")  +     # Set legend title\n  scale_linetype_discrete(name=\"Target Direction\") +\n  xlab(\"Target Distance\") +\n  ylab(\"Number of clutches\") +\n  geom_line(position=position_dodge(0.2)) +\n  geom_point(position=position_dodge(0.2))\n#ggtitle(\"Number of clutches against distance stratified by direction for the mid-air interaction method\")\n####################Model validation\npar(mfrow=c(2,2)) \t#For more plots in one window\nplot(d$nr_of_clutches,main = \"Plot of number of interactions before log tranformation\", ylab = \"Number of interactions\")\nplot(nr_of_clutches,main = \"Plot of number of interactions after log tranformation\", ylab = \"Number of interactions\")\nhist(d$nr_of_clutches,main = \"Histogram of number of interactions before log tranformation\", xlab = \"Number of interactions\")\nhist(nr_of_clutches,main = \"Histogram of number of interactions after log tranformation\", xlab = \"Number of interactions\")\n#Before transformation\nmodel1_nontrans<-lmer(d$nr_of_clutches ~ trial_type*target_distance + (1|user_id))\t\n\tresiduals_nontrans<-residuals(model1_nontrans)\n\tpar(mfrow=c(2,3)) \t#For more plots in one window\n\tplot(fitted(model1_nontrans),residuals_nontrans,main = \"Scatterplot of residuals before transformation\", ylab = \"Residuals before transformation\", xlab = \"Fitted model values\");  abline(0,0)\t\t\t\t#Test of the variance homogeneity\n\thist(residuals_nontrans,main = \"Histogram of residuals before transformation\", xlab = \"Residuals before transformation\")\t\t\t\t\t\t\t\t\t\t#Test of the normal distribution with histogram\n\tqqnorm(residuals(model1_nontrans),main = \"Normal QQ-plot before transformation\"); abline(mean(residuals_nontrans),sd(residuals_nontrans))\t#Test of the normal distribution with QQ-plot\n\n#Which transformation may be appropriate - using boxcox plot\n#boxcox(d$nr_of_clutches ~ trial_type*target_distance, )\t\t#Before transformation, lambda=0, meaning XXXX \n\n#After transformation\n\tresiduals<-residuals(model1)\n\tplot(fitted(model1),residuals,main = \"Scatterplot of residuals after transformation\", ylab = \"Residuals after transformation\", xlab = \"Fitted model values\");  abline(0,0)\t#Test of the variance homogeneity\n\thist(residuals,main = \"Histogram of residuals after transformation\", xlab = \"Residuals after transformation\")\t\t\t\t\t\t#Test of the normal distribution with histogram\n\tqqnorm(residuals(model1),main = \"Normal QQ-plot after transformation\"); abline(mean(residuals),sd(residuals))\t#Test of the normal distribution with QQ-plot\n\n#Which transformation may be appropriate - using boxcox plot \n#boxcox(nr_of_clutches ~ trial_type*target_distance)\t\t#After transformation, lambda=1, meaning XXXX \n\n\n####################Getting estimates - backtransformed\n#Transform and backtransform original data \ncbind(nr_of_clutches,log(d$nr_of_clutches+0.5),d$nr_of_clutches,exp(nr_of_clutches)-0.5)\n\n#Backtransform estimates for contrasts\n#The contrasts\nnames(CIs) #Get the names for extracting data form the output\n\tNames<-CIs$contrast[c(1,10,15)]\n\tEst<-CIs$estimate[c(1,10,15)];\tEst<-exp(Est)-0.5\n\tLL<-CIs$lower.CL[c(1,10,15)];\t\tLL<-exp(LL)-0.5\n\tUL<-CIs$upper.CL[c(1,10,15)];\t\tUL<-exp(UL)-0.5\n\tmatrix =cbind(as.vector(Names),Est,LL,UL)\t\t\t#Note, 0 is NOT included in the 95% CIs\n\n#The levels (FOR BAR PLOT - TO DO - USE LSM - REMEMBER TO BACKTRANSFORM)\ntabbedMeans <- tapply(as.numeric(as.vector(Q_dataframe$b)), list(Q_dataframe$a,\n                                                                 Q_dataframe$q),\n                      function(x) c(x = x))\ntabbedLow <- tapply(as.numeric(as.vector(Q_dataframe$c)), list(Q_dataframe$a,\n                                                               Q_dataframe$q),\n                    function(x) c(x = x))\ntabbedHigh <- tapply(as.numeric(as.vector(Q_dataframe$d)), list(Q_dataframe$a,\n                                                                Q_dataframe$q),\n                     function(x) c(x = x))\n\n\n####################Plot according to model3\nd$num_combine_trial_dist<-ifelse(d$combine_trial_dist==\"midairlong\",1,d$combine_trial_dist)\n\td[c(\"num_combine_trial_dist\",\"combine_trial_dist\")]\t\t#Check that it is correct\nplot(d$num_combine_trial_dist,d$nr_of_clutches,\n\tmain=\"XXXX\", ylab=\"nr of clutches\", xlab=\"trial type 1-3, midair long, median, short, and type 4-5, touch long, median, short\",\n\t,col=user_id,pch=18)\t\t#Choose symbol (pch) here: http://www.sthda.com/sthda/RDoc/figure/graphs/r-plot-pch-symbols-points-in-r.png\nplot(d$num_combine_trial_dist,nr_of_clutches,\n\tmain=\"XXXX\", ylab=\"log(nr of clutches) - PLEASE NOTE THIS IS LOG\", xlab=\"trial type 1-3, midair long, median, short, and type 4-5, touch long, median, short\",\n\t,col=user_id,pch=18)\n\n####################Export results\ncapture.output(CIs,file=paste(\"NAME OF THE DOCUMENT\",\".doc\",sep=\"\"))\n\n\n\n\n",
    "created" : 1485181722050.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1458008461",
    "id" : "307B4786",
    "lastKnownWriteTime" : 1488476991,
    "last_content_update" : 1488476991383,
    "path" : "~/Documents/master-thesis/evaluation/Statistics-no-of-clutches.R",
    "project_path" : "Statistics-no-of-clutches.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}