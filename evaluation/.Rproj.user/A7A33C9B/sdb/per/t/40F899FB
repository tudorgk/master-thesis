{
    "collab_server" : "",
    "contents" : "d=read.csv(\"data.csv\",header=TRUE)\nd;attach(d)\nhead(d)\n\n#install.packages(\"lme4\")\nlibrary(lme4);library(lsmeans);library(lmerTest);library(MASS)\nlibrary(ggplot2); library(Rmisc);\nlibrary(dplyr)\n\n\n####################Prepare data\n#Transform data - Because the residuals was not normally distributed in the model\n#INFO: page 231, 0.5 was added to all (Sokal and Rohlf) and a natural log transformation was done - because lambda = 0 in boxcox\ncompletion_time<-1/sqrt(d$completion_time)\n\n####################Data transformation\npar(mfrow=c(2,2)) \t#For more plots in one window\nplot(d$completion_time,main = \"Plot of completion times before power tranformation\", ylab = \"Completion time (s)\")\nplot(completion_time,main = \"Plot of completion times after power tranformation\", ylab = \"Completion time (s)\")\nhist(d$completion_time,main = \"Histogram of completion times before power tranformation\", xlab = \"Completion time (s)\")\nhist(completion_time,main = \"Histogram of completion times after power tranformation\", xlab = \"Completion time (s)\")\n\n\n###################Finding the right model\n#Quick look at the data\nd$combine_trial_dist<-as.factor(paste(trial_type,target_distance,sep=\"\"))\t\nplot(d$combine_trial_dist,completion_time)\t\t#Corresponds to model (without user_id)\nplot(trial_type,completion_time)\t\t\t#Corresponds to a model with only trial type\n\n\n##Model reduction\nmodel4<-lmer(completion_time ~ trial_type*target_distance + direction_axis*trial_type + task_number + (1|user_id))\t\t#Repeated measures factorial ANCOVA (mixed effects model) with interaction (user is random effect)\n\n#Repeated measures two-way ANOVA (mixed effects model) with interaction\nmodel3<-lmer(completion_time ~ trial_type*target_distance + direction_axis + task_number + (1|user_id))\nanova(model3,model4)\n\nmodel2<-lmer(completion_time ~ trial_type +target_distance + direction_axis + task_number + (1|user_id))\n\tanova(model2,model3)\n\n#The models are not significantly different(p>0.05) (the interaction is not significant), so \n #we carry on with model 2.\n\n#Test of task_number\nmodel1<-lmer(completion_time ~ trial_type +target_distance + direction_axis + (1|user_id))\n\tanova(model2,model1)\n\n#The models are not significantly different(p>0.05) (task_number is not significant), so \n #we carry on with model 1.\n\n#Test of direction_axis\nmodel0<-lmer(completion_time ~ trial_type +target_distance + (1|user_id))\n\tanova(model1,model0)\n\n#They are significantly different, so model 1 is our final model (direction_axis is significant).\n\n##################### Model validation\n#Before transformation\nmodel1_nontrans<-lmer(d$completion_time ~ trial_type +target_distance + direction_axis + (1|user_id))\t\nresiduals_nontrans<-residuals(model1_nontrans)\npar(mfrow=c(2,3)) \t#For more plots in one window\nplot(fitted(model1_nontrans),residuals_nontrans,main = \"Scatterplot of residuals before transformation\", ylab = \"Residuals before transformation\", xlab = \"Fitted model values\");  abline(0,0)\t\t\t\t#Test of the variance homogeneity\nhist(residuals_nontrans,main = \"Histogram of residuals before transformation\", xlab = \"Residuals before transformation\")\t\t\t\t\t\t\t\t\t\t#Test of the normal distribution with histogram\nqqnorm(residuals(model1_nontrans),main = \"Normal QQ-plot before transformation\"); abline(mean(residuals_nontrans),sd(residuals_nontrans))\t#Test of the normal distribution with QQ-plot\n\n#Which transformation may be appropriate - using boxcox plot\n#boxcox(d$nr_of_clutches ~ trial_type*target_distance, )\t\t#Before transformation, lambda=0, meaning XXXX \n\n#After transformation\nresiduals<-residuals(model1)\nplot(fitted(model1),residuals,main = \"Scatterplot of residuals after transformation\", ylab = \"Residuals after transformation\", xlab = \"Fitted model values\");  abline(0,0)\t#Test of the variance homogeneity\nhist(residuals,main = \"Histogram of residuals after transformation\", xlab = \"Residuals after transformation\")\t\t\t\t\t\t#Test of the normal distribution with histogram\nqqnorm(residuals(model1),main = \"Normal QQ-plot after transformation\"); abline(mean(residuals),sd(residuals))\t#Test of the normal distribution with QQ-plot\n\n#####################Hypothesis testing - Test if there is a difference between trial types\nmodel00<-lmer(completion_time ~ target_distance + direction_axis +(1|user_id))\nanova(model1,model00)\t\t\t#The test\n\n####################Hypothesis testing - Test if there is a difference between trial types\n#From above we saw that the interaction was insignificant. With LSM we can test the difference for each level.\nLSM<-lsmeans::lsmeans(model1, ~ trial_type * target_distance)\t#Estimates for each level\nT<-contrast(LSM, \"pairwise\",adjust=\"none\");T\t\t#Estimates for the contrasts\nCIs<-confint(T)\t\t\t\t\t\t\t#95% CIs for the contrasts\n#Read about lsmeans: https://cran.r-project.org/web/packages/lsmeans/vignettes/using-lsmeans.pdf\nLSM_summary<-summary(LSM)\n#Back transforming\nLSM_summary$lsmean <- 1/(LSM_summary$lsmean)^2\nLSM_summary$lower.CL <- 1/(LSM_summary$lower.CL)^2\nLSM_summary$upper.CL <- 1/(LSM_summary$upper.CL)^2\nLSM_summary$target_distance <- factor(LSM_summary$target_distance, levels = rev(levels(LSM_summary$target_distance)))\nggplot(LSM_summary, aes(x=target_distance, y=lsmean, colour=trial_type, group=trial_type)) + \n  geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=.1, \n                position=position_dodge(0.05)) +\n  scale_colour_hue(name=\"Interaction Method\")  +     # Set legend title\n  scale_linetype_discrete(name=\"Interaction Method\") +\n  xlab(\"Target Distance\") +\n  ylab(\"Completion time (s)\") +\n  geom_line() +\n  geom_point()\n\n#####################\nLSM_with_direction<-lsmeans::lsmeans(model1,~trial_type*target_distance*direction_axis)\t#Estimates for each level\nT_with_direction<-contrast(LSM_with_direction, \"pairwise\",adjust=\"none\");\t\t#Estiates for the contrasts\nLSM_summary<-summary(LSM_with_direction)\n\n#capture.output(T_with_direction,file=paste(\"Direction Contrast Completion time\",\".txt\",sep=\"\"))\n\n#Back transforming\nLSM_summary$lsmean <- 1/(LSM_summary$lsmean)^2\nLSM_summary$lower.CL <- 1/(LSM_summary$lower.CL)^2\nLSM_summary$upper.CL <- 1/(LSM_summary$upper.CL)^2\nLSM_summary$target_distance <- factor(LSM_summary$target_distance, levels = rev(levels(LSM_summary$target_distance)))\n\n#Subset\nmidair.subset<-subset(LSM_summary,trial_type==\"midair\")\ntouch.subset<-subset(LSM_summary,trial_type==\"touch+inertia\")\n\nggplot(midair.subset, aes(x=target_distance, y=lsmean, colour=direction_axis, shape=direction_axis, group=interaction(trial_type,direction_axis))) + \n  geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=.1, \n                position=position_dodge(0.2)) +\n  scale_colour_hue(name=\"Target Direction\")  +     # Set legend title\n  scale_shape_manual(values=1:8, name=\"Target Direction\") +\n  scale_linetype_discrete(name=\"Target Direction\") +\n  xlab(\"Target Distance\") +\n  ylab(\"Completion time (s)\") +\n  geom_line(position=position_dodge(0.2)) +\n  geom_point(position=position_dodge(0.2))\n\nggplot(touch.subset, aes(x=target_distance, y=lsmean, colour=direction_axis, group=interaction(trial_type,direction_axis))) + \n  geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=.1, \n                position=position_dodge(0.2)) +\n  scale_colour_hue(name=\"Target Direction\")  +     # Set legend title\n  scale_linetype_discrete(name=\"Target Direction\") +\n  xlab(\"Target Distance\") +\n  ylab(\"Completion time (s)\") +\n  geom_line(position=position_dodge(0.2)) +\n  geom_point(position=position_dodge(0.2))\n\n##################Estimates from the model\nsummary(model1)\t\t\t\t#The estimates HAVE TO BE BACKTRANSFORMED\n\nconfint(model1)\t\t\t\t#HAVE TO BE TRANSFORMED BACK\n\n\n#################Model validation\n\nresiduals<-residuals(model1)\n\n#Test of the variance homogeneity\nplot(fitted(model1),residuals);  abline(0,0)\n\n#Test of the normal distribution\nhist(residuals)\nqqnorm(residuals(model1)); abline(mean(residuals),sd(residuals))\n\n\n\n#######Rod\nboxcox(completion_time ~ trial_type+target_distance)\t\t## NB NBNBNBNBNB\n\n\n\n\n\n",
    "created" : 1485181617196.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1586732975",
    "id" : "40F899FB",
    "lastKnownWriteTime" : 1488480088,
    "last_content_update" : 1488480088,
    "path" : "~/Documents/master-thesis/evaluation/Statistics-completion-time.R",
    "project_path" : "Statistics-completion-time.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}